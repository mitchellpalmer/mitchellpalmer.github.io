---
title: "Height at the Olympics"
description: |
  A short description of the post.
author:
  - name: Mitchell Palmer
    url: https://mitchellpalmer.nz
date: 08-01-2021
output:
  distill::distill_article:
    self_contained: false
draft: true
---


```{r setup, include=FALSE}
library("rvest")
library(countrycode)
library(wbstats)
library(tidyverse)

height_doc <- read_html("https://en.wikipedia.org/wiki/Average_human_height_by_country")
raw_height <- html_table(html_nodes(height_doc, "table")[[1]])

medals_doc <- read_html("https://olympics.com/tokyo-2020/olympic-games/en/results/all-sports/medal-standings.htm")
medals <- html_table(html_nodes(medals_doc, "table")[[1]])
names(medals)[3:5] <- c("Gold", "Silver", "Bronze")

medals <- medals %>% 
  mutate(iso3c = countrycode(NOCCode, 
                             origin = 'ioc', 
                             destination = 'iso3c',
                             custom_match = c("KOS"="XKX","ROC"="RUS")),
         continent = countrycode(iso3c, 
                                 origin = 'iso3c', 
                                 destination = 'continent',
                                 custom_match = c("XKX"="Europe")))

population <- wb(indicator = c("SP.POP.TOTL"), mrv = 1)

medals_per_capita <- left_join(medals, 
                               population) %>%
  select(names(medals),
         population=value,
         iso2c,
         country)


first_measurement = "([0-9]{3})([.][0-9])?"
first_year = "([0-9]{4})"

height <- raw_height %>%
  mutate(male_height = as.numeric(str_extract(`Average male height`, first_measurement)),
         female_height = as.numeric(str_extract(`Average female height`, first_measurement)),
         year = as.numeric(str_extract(`Year`, first_year))) %>%
  arrange(desc(year)) %>% 
  group_by(`Country / Region`) %>% 
  slice(1:1)

average_ratio <- mean(as.numeric(height$`Stature ratio(male to female)`), na.rm = T)

height <- height %>%
  mutate(male_height = ifelse(is.na(male_height), female_height * average_ratio, male_height),
         female_height = ifelse(is.na(female_height), male_height/average_ratio, female_height)) %>%
  select(country=`Country / Region`,
         male_height,
         female_height,
         year)

height[height$country=='United Kingdom – England','country'] <- "United Kingdom"
height[height$country=='Cuba – Urban','country'] <- "Cuba"
height[height$country=='Slovenia – Ljubljana','country'] <- "Slovenia"
height[height$country=='Ivory Coast','country'] <- "Cote d'Ivoire"
medals_per_capita[medals_per_capita$iso3c=='RUS','country'] <- "Russia"
medals_per_capita[medals_per_capita$iso3c=='KOR','country'] <- "South Korea"
medals_per_capita[medals_per_capita$iso3c=='IRN','country'] <- "Iran"
medals_per_capita[medals_per_capita$iso3c=='VEN','country'] <- "Venezuela"
medals_per_capita[medals_per_capita$iso3c=='EGY','country'] <- "Egypt"
medals_per_capita[medals_per_capita$iso3c=='SVK','country'] <- "Slovakia"
medals_per_capita[medals_per_capita$iso3c=='HKG','country'] <- "Hong Kong"

joined_data <- medals_per_capita %>% 
  left_join(height) %>%
  mutate(weighted_medals = (3 * Gold + 2 * Silver + Bronze),
         weighted_per_million = weighted_medals/(population/10^6),
         gold_per_million = Gold/(population/10^6),
         total_per_million = Total/(population/10^6),
         average_height = (male_height + female_height)/2)

knitr::opts_chunk$set(echo = FALSE)

```

Height is acknowledged to be a core component of many sports. So I wanted to see how closely Olympic performance tracked with the average height of countries.

```{r}
ggplot(data = joined_data, aes(x=average_height, y=weighted_per_million, size=population)) +
  geom_point(aes(color=continent)) +
  # geom_smooth(method="lm")+
  scale_y_continuous(limits = c(0, 5), 
                     name="Weighted medal count per million") +
  scale_x_continuous(name="Average height (men and women) in cm") + 
  guides(size=F) + 
  labs(title="Weighted medals per capita, by average height",
       subtitle="Gold = 3; silver = 2; bronze = 1",
       caption = "Data: IOC, Wikipedia\n\nGraph: Mitchell Palmer\nmitchellpalmer.github.io") +
  theme_minimal()

ggplot(data = joined_data, aes(x=average_height, y=total_per_million, size=population)) +
  geom_point(aes(color=continent)) +
  # geom_smooth(method="lm")+
  scale_y_continuous(limits = c(0, 2.5), 
                     name="Total medal count per million") +
  scale_x_continuous(name="Average height (men and women) in cm") + 
  guides(size=F) + 
  labs(title="Total medals per capita, by average height",
       caption = "Data: IOC, Wikipedia\n\nGraph: Mitchell Palmer\nmitchellpalmer.github.io") +
  theme_minimal()

ggplot(data = joined_data, aes(x=average_height, y=gold_per_million, size=population)) +
  geom_point(aes(color=continent)) +
  # geom_smooth(method="lm")+
  scale_y_continuous(limits = c(0, 1.5), 
                     name="Gold medal count per million") +
  scale_x_continuous(name="Average height (men and women) in cm") + 
  guides(size=F) + 
  labs(title="Gold medals per capita, by average height",
       caption = "Data: IOC, Wikipedia\n\nGraph: Mitchell Palmer\nmitchellpalmer.github.io") +
  theme_minimal()

```

It's possible that the main driver of this seeming relationship is Europe. Given Europe is the richest continent and most Olympic sports have their roots there, perhaps those endowments are what drives these results, not their height. So lets look within Europe.

```{r}
ggplot(data = joined_data %>% filter(continent="Europe"), 
       aes(x=average_height, y=weighted_per_million, size=population)) +
  geom_point() +
  # geom_smooth(method="lm")+
  scale_y_continuous(limits = c(0, 5), 
                     name="Weighted medal count per million") +
  scale_x_continuous(name="Average height (men and women) in cm") + 
  guides(size=F) + 
  labs(title="Weighted medals per capita, by average height, within Europe",
       subtitle="Gold = 3; silver = 2; bronze = 1",
       caption = "Data: IOC, Wikipedia\n\nGraph: Mitchell Palmer\nmitchellpalmer.github.io") +
  theme_minimal()

```


